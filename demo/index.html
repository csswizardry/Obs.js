<!doctype html>
<html lang=en-gb>
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width, minimum-scale=1.0">

  <!-- Optional config: observe live changes in this demo -->
  <script>window.obs = { config: { observeChanges: true } };</script>

  <script>
    performance.mark('obs_start');
    /*! Obs.js 0.2.1 | (c) Harry Roberts, csswizardry.com | MIT */
    ;(()=>{const e=document.currentScript;if((!e||e.src||e.type&&"module"===e.type.toLowerCase())&&!1===/^(localhost|127\.0\.0\.1|::1)$/.test(location.hostname))return void console.warn("[Obs.js] Skipping: must be an inline, classic <script> in <head>.",e?e.src?"src="+e.src:"type="+e.type:"type=module");const t=document.documentElement,{connection:i}=navigator;window.obs=window.obs||{};const a=!0===(window.obs&&window.obs.config||{}).observeChanges,o=()=>{const e=window.obs||{},i="number"==typeof e.downlinkBucket?e.downlinkBucket:null;e.connectionCapability="low"===e.rttCategory&&null!=i&&i>=8?"strong":"high"===e.rttCategory||null!=i&&i<=5?"weak":"moderate";const a=!0===e.dataSaver||!0===e.batteryLow||!0===e.batteryCritical;e.conservationPreference=a?"conserve":"neutral";const o="weak"===e.connectionCapability||!0===e.dataSaver||!0===e.batteryCritical;e.deliveryMode="strong"!==e.connectionCapability||o||a?o?"lite":"cautious":"rich",e.canShowRichMedia="lite"!==e.deliveryMode,e.shouldAvoidRichMedia="lite"===e.deliveryMode,["strong","moderate","weak"].forEach(e=>{t.classList.remove(`has-connection-capability-${e}`)}),t.classList.add(`has-connection-capability-${e.connectionCapability}`),["conserve","neutral"].forEach(e=>{t.classList.remove(`has-conservation-preference-${e}`)}),t.classList.add(`has-conservation-preference-${e.conservationPreference}`),["rich","cautious","lite"].forEach(e=>{t.classList.remove(`has-delivery-mode-${e}`)}),t.classList.add(`has-delivery-mode-${e.deliveryMode}`)},n=()=>{if(!i)return;const{saveData:e,rtt:a,downlink:n}=i;window.obs.dataSaver=!!e,t.classList.toggle("has-data-saver",!!e);const s=(e=>Number.isFinite(e)?25*Math.ceil(e/25):null)(a);null!=s&&(window.obs.rttBucket=s);const r=(e=>Number.isFinite(e)?e<75?"low":e<=275?"medium":"high":null)(a);r&&(window.obs.rttCategory=r,["low","medium","high"].forEach(e=>t.classList.remove(`has-latency-${e}`)),t.classList.add(`has-latency-${r}`));const c=(l=n,Number.isFinite(l)?Math.ceil(l):null);var l;if(null!=c){window.obs.downlinkBucket=c;const e=c<=5?"low":c>=8?"high":"medium";window.obs.downlinkCategory=e,["low","medium","high"].forEach(e=>t.classList.remove(`has-bandwidth-${e}`)),t.classList.add(`has-bandwidth-${e}`)}"downlinkMax"in i&&(window.obs.downlinkMax=i.downlinkMax),o()};n(),a&&i&&"function"==typeof i.addEventListener&&i.addEventListener("change",n);const s=e=>{if(!e)return;const{level:i,charging:a}=e,n=Number.isFinite(i)?i<=.05:null;window.obs.batteryCritical=n;const s=Number.isFinite(i)?i<=.2:null;window.obs.batteryLow=s,["critical","low"].forEach(e=>t.classList.remove(`has-battery-${e}`)),s&&t.classList.add("has-battery-low"),n&&t.classList.add("has-battery-critical");const r=!!a;window.obs.batteryCharging=r,t.classList.toggle("has-battery-charging",r),o()};if("getBattery"in navigator&&navigator.getBattery().then(e=>{s(e),a&&"function"==typeof e.addEventListener&&(e.addEventListener("levelchange",()=>s(e)),e.addEventListener("chargingchange",()=>s(e)))}).catch(()=>{}),"deviceMemory"in navigator){const e=Number(navigator.deviceMemory),i=Number.isFinite(e)?e:null;window.obs.ramBucket=i;const a=(r=i,Number.isFinite(r)?r<=1?"very-low":r<=2?"low":r<=4?"medium":"high":null);a&&(window.obs.ramCategory=a,["very-low","low","medium","high"].forEach(e=>t.classList.remove(`has-ram-${e}`)),t.classList.add(`has-ram-${a}`))}var r;if("hardwareConcurrency"in navigator){const e=Number(navigator.hardwareConcurrency),i=Number.isFinite(e)?e:null;window.obs.cpuBucket=i;const a=(e=>Number.isFinite(e)?e<=2?"low":e<=5?"medium":"high":null)(i);a&&(window.obs.cpuCategory=a,["low","medium","high"].forEach(e=>t.classList.remove(`has-cpu-${e}`)),t.classList.add(`has-cpu-${a}`))}(()=>{const e=window.obs||{},i=e.ramCategory,a=e.cpuCategory;let o="moderate";"high"!==i&&"medium"!==i||"high"!==a?("very-low"===i||"low"===i||"low"===a)&&(o="weak"):o="strong",e.deviceCapability=o,["strong","moderate","weak"].forEach(e=>{t.classList.remove(`has-device-capability-${e}`)}),t.classList.add(`has-device-capability-${o}`)})()})();
    //# sourceURL=obs.inline.js
    performance.mark('obs_end');
    const obs_time = performance.measure('obs_time', 'obs_start', 'obs_end');
    console.log('Obs.js time: ' + obs_time.duration)
  </script>

  <title>Obs.js – context-aware web performance for everyone</title>

  <style>

    :root {
      --fg:          #333;
      --bg:          #f9f9f9;
      --brand:       #009aa2;
      --csswizardry: #f43059;
      --ok:          #0a0;
      --warn:        #a60;
      --bad:         #a00;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    h1, h2,
    p,
    details,
    pre,
    ul,
    .c-snippet,
    .c-hero,
    .c-video > video,
    .c-video >img {
      margin-bottom: 1.5rem;
    }

    ol {
      margin-left: 1.5rem;
    }

    @media (min-width: 45em) {
      ol {
        margin-left: 0;
      }
    }

    html {
      color: var(--fg);
      background-color: var(--bg);
      font: 1em/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-weight: 400;
    }

    body {
      max-width: 70ch;
      margin-right: auto;
      margin-left:  auto;
      padding: 1.5rem;
    }

    h1, h2 {
      text-wrap: balance;
      color: var(--brand);
      font-family: 'Fredoka', system-ui, sans-serif;
      font-weight: 500;
    }

    .has-delivery-mode-lite h1,
    .has-delivery-mode-lite h2 {
      font-family: system-ui, sans-serif;
      font-weight: 700;
    }

    h1 {
      font-size: 2.5rem;
      line-height: 1.2;
    }

    /**
     * Create a tighter lockup with the logo and heading group.
     *
     * 1. One baseline grid unit.
     * 2. Create a ‘dead zone’ so the logo and heading can never touch despite
     *    overlapping. This is a magic number that just-about exactly matches
     *    the width if the logo’s ‘js’.
     * 3. Uncomment this if you want to see it in action.
     */
    hgroup {
      margin-top: -1.5rem; /* [1] */
    }

    /* Dead-zone so headings never touch logo */
    hgroup::before {
      content: "";
      display: block;
      width: 30%; /* [2] */
      height: 1.5rem;
      float: right;
      /* background-color: red; */ /* [3] */
    }

    hgroup h1 {
      margin-bottom: 0;
    }

    h2 {
      font-size: 1.5rem;
      line-height: 1;
    }

    code, kbd, samp, output, pre,
    .c-snippet{
      font-family: "Operator Mono", ui-monospace, monospace;
    }

    a, summary {
      cursor: pointer;
      color: var(--csswizardry);
      text-decoration: none;
      font-weight: 600;
    }

    a:hover,
    a:active,
    a:focus,
    summary:hover,
    summary:active,
    summary:focus {
      text-decoration: underline;
    }

    a[href^="#"]::after,
    a[href^="https://csswizardry.com"]::after,
    a[href^="https://github.com"]::after,
    a[href^="https://developer.mozilla.org"]::after,
    a[href^="https://fonts.google.com/"]::after,
    a[href^="https://www.speedcurve.com/"]::after {
      content: "";
      display: inline-block;
      width: 1ch;
      height: 1ch;
      background-size: cover;
      margin-left: 0.1ch;
      vertical-align: super;
      font-style: normal;
    }

    a[href^="#"]::after {
      background-image: url(./assets/icon.png);
    }

    a[href^="https://csswizardry.com"]::after {
      border-radius: 1px;
      background-image: url(https://csswizardry.com/icon.png);
    }

    a[href^="https://github.com"]::after {
      background-image: url(https://github.githubassets.com/favicons/favicon.svg);
    }

    a[href^="https://developer.mozilla.org"]::after {
      background-image: url(https://developer.mozilla.org/favicon.svg);
    }

    a[href^="https://fonts.google.com"]::after {
      background-image: url(https://www.gstatic.com/images/icons/material/apps/fonts/1x/catalog/v5/favicon.svg);
    }

    a[href^="https://www.speedcurve.com"]::after {
      background-image: url(https://www.speedcurve.com/favicon.ico);
    }

    details[open] summary {
      margin-bottom: 1.5rem;
    }

    :root details a::after {
      content: initial;
    }

    abbr {
      cursor: help;
    }

    dfn {
      font-style: normal;;
    }

    img, video {
      max-width: 100%;
      height: auto;
      display: block;
    }

    :target {
      background-color: #ffc;
      scroll-margin-top: 1.5rem;
    }

    h2:target {
      outline: 10px solid #ffc;
    }

    .c-snippet {
      display: block;
      background-color: #002a35;
      color: #829396;
      white-space: pre;
      border-radius: 4px;
      overflow: auto;
      text-transform: none;
      padding-right: 2.5em;
    }

    .c-video > video {
      aspect-ratio: 312 / 202;
    }

    /**
     * Zoom images on demand on devices that allow it. I need to think of
     * a better option on mobile.
     */
    @media (hover:hover) {

      .c-hero {
        cursor: zoom-in;
        transition: 0.2s transform;
        will-change: transform;

        &:active,
        &:focus {
          transform: scale(2);
        }

      }

    }

    .c-pill {
      display: inline-block;
      border: 1px solid #ccc;
      padding: .15rem .5rem;
      border-radius: 999px;
      margin: .15rem .25rem .15rem 0;
    }

    .u-good {
      background: #e9f6ea;
      border-color: #cfe9d2;
      color: var(--ok);
    }

    .u-warn {
      background: #fff3e0;
      border-color: #ffe0b2;
      color: var(--warn);
    }

    .u-bad {
      background: #fdecea;
      border-color: #f5c6cb;
      color: var(--bad);
    }

    /*# sourceURL=style.inline.css */
  </style>

  <script>
    LUX=(function(){var a=("undefined"!==typeof(LUX)&&"undefined"!==typeof(LUX.gaMarks)?LUX.gaMarks:[]);var d=("undefined"!==typeof(LUX)&&"undefined"!==typeof(LUX.gaMeasures)?LUX.gaMeasures:[]);var j="LUX_start";var k=window.performance;var l=("undefined"!==typeof(LUX)&&LUX.ns?LUX.ns:(Date.now?Date.now():+(new Date())));if(k&&k.timing&&k.timing.navigationStart){l=k.timing.navigationStart}function f(){if(k&&k.now){return k.now()}var o=Date.now?Date.now():+(new Date());return o-l}function b(n){if(k){if(k.mark){return k.mark(n)}else{if(k.webkitMark){return k.webkitMark(n)}}}a.push({name:n,entryType:"mark",startTime:f(),duration:0});return}function m(p,t,n){if("undefined"===typeof(t)&&h(j)){t=j}if(k){if(k.measure){if(t){if(n){return k.measure(p,t,n)}else{return k.measure(p,t)}}else{return k.measure(p)}}else{if(k.webkitMeasure){return k.webkitMeasure(p,t,n)}}}var r=0,o=f();if(t){var s=h(t);if(s){r=s.startTime}else{if(k&&k.timing&&k.timing[t]){r=k.timing[t]-k.timing.navigationStart}else{return}}}if(n){var q=h(n);if(q){o=q.startTime}else{if(k&&k.timing&&k.timing[n]){o=k.timing[n]-k.timing.navigationStart}else{return}}}d.push({name:p,entryType:"measure",startTime:r,duration:(o-r)});return}function h(n){return c(n,g())}function c(p,o){for(i=o.length-1;i>=0;i--){var n=o[i];if(p===n.name){return n}}return undefined}function g(){if(k){if(k.getEntriesByType){return k.getEntriesByType("mark")}else{if(k.webkitGetEntriesByType){return k.webkitGetEntriesByType("mark")}}}return a}return{mark:b,measure:m,gaMarks:a,gaMeasures:d}})();LUX.ns=(Date.now?Date.now():+(new Date()));LUX.ac=[];LUX.cmd=function(a){LUX.ac.push(a)};LUX.init=function(){LUX.cmd(["init"])};LUX.send=function(){LUX.cmd(["send"])};LUX.addData=function(a,b){LUX.cmd(["addData",a,b])};LUX_ae=[];window.addEventListener("error",function(a){LUX_ae.push(a)});LUX_al=[];if("function"===typeof(PerformanceObserver)&&"function"===typeof(PerformanceLongTaskTiming)){var LongTaskObserver=new PerformanceObserver(function(c){var b=c.getEntries();for(var a=0;a<b.length;a++){var d=b[a];LUX_al.push(d)}});try{LongTaskObserver.observe({type:["longtask"]})}catch(e){}};
    LUX = window.LUX || {};
    LUX.samplerate = 100;
    LUX.label = 'Obs.js';
    //# sourceURL=speedcurve.inline.js
  </script>
  <script src="https://cdn.speedcurve.com/js/lux.js?id=47684395" defer crossorigin></script>

  <script src="https://www.googletagmanager.com/gtag/js?id=G-DNCL1RY4GT" async crossorigin></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-DNCL1RY4GT');
  </script>

  <meta name=title content="Obs.js – context-aware web performance for everyone">
  <meta name=description content="Obs.js reads device and network signals and allows you to build adaptive user experiences.">
  <meta name=author content="Harry Roberts">
  <meta name=theme-color content="#009aa2">
  <meta name=robots content="index, follow, max-image-preview:large">
  <link rel=icon href=./assets/icon.png>

  <meta property="og:site_name" content="CSS Wizardry">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_GB">
  <meta property="og:title" content="Obs.js – context-aware web performance for everyone">
  <meta property="og:description" content="Obs.js reads device and network signals and allows you to build adaptive user experiences.">
  <meta property="og:url" content="https://csswizardry.com/Obs.js/demo/">
  <meta property="og:image" content="https://csswizardry.com/Obs.js/demo/assets/og-image.png">
  <meta property="og:image:width" content="1800">
  <meta property="og:image:height" content="942">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:alt" content="Obs.js demo page with video poster frame showing context-aware performance demo">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@csswizardry">
  <meta name="twitter:creator" content="@csswizardry">
  <meta name="twitter:domain" content="csswizardry.com">
  <meta name="twitter:title" content="Obs.js – context-aware web performance for everyone">
  <meta name="twitter:description" content="Obs.js reads device and network signals and allows you to build adaptive user experiences.">
  <meta name="twitter:image" content="https://csswizardry.com/Obs.js/demo/assets/og-image.png">
  <meta name="twitter:image:alt" content="Obs.js demo page with video poster frame showing context-aware performance demo">





  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 510 164.36" role="img" aria-labelledby="logo-title">
    <title id="logo-title">Obs.js Logo</title>
    <defs>
      <style>
        .color-dot {
          fill: #f43059;
        }

        .color-text {
          fill: #009aa2;
        }
      </style>
    </defs>
    <g id="Obs.js_Logo" data-name="Obs.js Logo">
      <g>
        <circle class="color-dot" cx="361.31" cy="85.22" r="15.47"/>
        <path class="color-text" d="M472.27,136.2c-6.99,0-14.14-1.2-21.44-3.59-7.3-2.39-17.86-9.33-17.86-9.33-1.67-1.09-2.14-3.36-1.05-5.03l8.01-12.33c1.09-1.67,3.35-2.16,5.03-1.09,0,0,7.71,4.93,13.05,6.88,5.34,1.96,10.34,2.95,15,2.95,4.05,0,7.02-.67,8.93-2.02,1.9-1.35,2.01-1.81,2.01-1.81.46-1.94.84-3.61.84-3.71s-.25-1.43-.55-2.95l-1.11-1.1c-1.1-1.1-2.61-2.05-4.51-2.85-1.9-.8-4.08-1.56-6.53-2.3-2.46-.74-5.03-1.53-7.73-2.39-3.44-.98-6.9-2.18-10.4-3.59-3.49-1.41-6.66-3.25-9.48-5.52-2.82-2.27-5.12-5.06-6.9-8.38-1.78-3.31-2.31-8.54-2.31-8.54-.2-1.98-.36-3.69-.36-3.79s.16-1.81.36-3.79c0,0,.59-5.87,2.49-9.74s4.48-7.15,7.73-9.85c3.25-2.7,7.05-4.72,11.41-6.07,4.35-1.35,9.05-2.02,14.08-2.02,6.26,0,12.61,1.01,19.05,3.04,6.44,2.02,14.6,6.6,14.6,6.6,1.74.98,2.37,3.2,1.41,4.94l-7.17,12.98c-.96,1.74-3.2,2.42-4.96,1.5,0,0-6.48-3.38-11.14-5.04-4.67-1.66-8.77-2.48-12.33-2.48s-6.01.64-7.73,1.93c-1.72,1.29-1.74,1.35-1.74,1.35-.46,1.94-.84,3.61-.84,3.71s.25,1.33.55,2.73l1.1,1.04c1.1,1.04,2.58,2.02,4.42,2.95,1.84.92,3.96,1.81,6.35,2.67,2.39.86,4.94,1.72,7.64,2.58,3.43,1.1,6.93,2.42,10.49,3.96,3.56,1.54,6.75,3.41,9.57,5.61,2.82,2.21,5.15,4.91,6.99,8.1,1.84,3.19,2.37,7.99,2.37,7.99.22,1.98.39,3.68.39,3.78s-.15,1.81-.33,3.79c0,0-.62,6.67-2.52,10.66-1.9,3.99-4.57,7.27-8.01,9.85-3.44,2.58-7.45,4.51-12.06,5.8-4.6,1.29-9.54,1.93-14.82,1.93Z"/>
        <path class="color-text" d="M206.87,136.2c-7.49,0-13.66-1.47-18.5-4.42-4.85-2.95-9.67-7.75-9.67-7.75-1.41-1.41-2.57-.93-2.57,1.07v5.64c0,1.99-1.63,3.62-3.62,3.62h-20.73c-1.99,0-3.62-1.63-3.62-3.62V3.62c0-1.99,1.63-3.62,3.62-3.62h20.73c1.99,0,3.62,1.63,3.62,3.62v42.63c0,1.99,1.09,2.41,2.41.92,0,0,5.16-5.79,10.01-8.8,4.84-3.01,10.95-4.51,18.31-4.51,5.76,0,11.35,1.11,16.75,3.31,5.4,2.21,10.19,5.49,14.36,9.85,4.17,4.36,7.51,9.69,10.03,16.01,2.51,6.32,3.48,18.2,3.48,18.2.16,1.99.29,3.69.29,3.79s-.13,1.81-.29,3.79c0,0-.96,11.88-3.48,18.2-2.52,6.32-5.83,11.66-9.94,16.01-4.11,4.36-8.87,7.64-14.26,9.85-5.4,2.21-11.04,3.31-16.93,3.31ZM199.7,112.46c3.31,0,6.41-.64,9.3-1.93,2.88-1.29,5.43-3.13,7.63-5.52,2.21-2.39,3.96-5.24,5.25-8.56,1.29-3.31,1.64-7.62,1.64-7.62.16-1.99.29-3.69.29-3.79s-.13-1.81-.3-3.79c0,0-.34-4.15-1.63-7.53-1.29-3.37-3.04-6.26-5.25-8.65-2.21-2.39-4.75-4.23-7.63-5.52-2.89-1.29-5.99-1.93-9.3-1.93s-6.41.64-9.3,1.93c-2.88,1.29-5.4,3.13-7.55,5.52-2.15,2.39-3.86,5.28-5.15,8.65-1.29,3.38-1.63,7.53-1.63,7.53-.17,1.99-.3,3.69-.3,3.79s.14,1.81.3,3.79c0,0,.35,4.15,1.63,7.53,1.29,3.38,3,6.26,5.15,8.65,2.15,2.39,4.66,4.23,7.55,5.52,2.88,1.29,5.98,1.93,9.3,1.93Z"/>
        <path class="color-text" d="M418.71,38.11c0-1.99-1.63-3.62-3.62-3.62h-20.73c-1.99,0-3.62,1.63-3.62,3.62v88.75c0,1.99-.21,5.24-.46,7.22,0,0-.46,3.52-2.3,5.24-1.84,1.72-4.23,2.58-7.18,2.58-1.72,0-2.3-.08-2.3-.08-1.98-.26-3.59,1.15-3.59,3.15v14.66c0,1.99,1.61,3.89,3.57,4.22,0,0,.26.04,2.04.23,1.78.18,3.96.27,6.53.27,10.43,0,18.31-2.55,23.65-7.64,5.34-5.09,7.5-20.43,7.5-20.43.28-1.97.51-5.22.51-7.21V38.11Z"/>
        <path class="color-text" d="M297.79,136.2c-6.99,0-14.14-1.2-21.44-3.59-7.3-2.39-17.86-9.33-17.86-9.33-1.67-1.09-2.14-3.36-1.05-5.03l8.01-12.33c1.09-1.67,3.35-2.16,5.03-1.09,0,0,7.71,4.93,13.05,6.88,5.34,1.96,10.34,2.95,15,2.95,4.05,0,7.02-.67,8.93-2.02,1.9-1.35,2.01-1.81,2.01-1.81.46-1.94.84-3.61.84-3.71s-.25-1.43-.55-2.95l-1.11-1.1c-1.1-1.1-2.61-2.05-4.51-2.85-1.9-.8-4.08-1.56-6.53-2.3-2.46-.74-5.03-1.53-7.73-2.39-3.44-.98-6.9-2.18-10.4-3.59-3.49-1.41-6.66-3.25-9.48-5.52-2.82-2.27-5.12-5.06-6.9-8.38-1.78-3.31-2.31-8.54-2.31-8.54-.2-1.98-.36-3.69-.36-3.79s.16-1.81.36-3.79c0,0,.59-5.87,2.49-9.74,1.9-3.86,4.48-7.15,7.73-9.85,3.25-2.7,7.05-4.72,11.41-6.07,4.35-1.35,9.05-2.02,14.08-2.02,6.26,0,12.61,1.01,19.05,3.04,6.44,2.02,14.6,6.6,14.6,6.6,1.74.98,2.37,3.2,1.41,4.94l-7.17,12.98c-.96,1.74-3.2,2.42-4.96,1.5,0,0-6.48-3.38-11.14-5.04-4.67-1.66-8.77-2.48-12.33-2.48s-6.01.64-7.73,1.93c-1.72,1.29-1.74,1.35-1.74,1.35-.46,1.94-.84,3.61-.84,3.71s.25,1.33.55,2.73l1.1,1.04c1.1,1.04,2.58,2.02,4.42,2.95,1.84.92,3.96,1.81,6.35,2.67,2.39.86,4.94,1.72,7.64,2.58,3.43,1.1,6.93,2.42,10.49,3.96,3.56,1.54,6.75,3.41,9.57,5.61,2.82,2.21,5.15,4.91,6.99,8.1,1.84,3.19,2.37,7.99,2.37,7.99.22,1.98.39,3.68.39,3.78s-.15,1.81-.33,3.79c0,0-.62,6.67-2.52,10.66-1.9,3.99-4.57,7.27-8.01,9.85-3.44,2.58-7.45,4.51-12.06,5.8-4.6,1.29-9.54,1.93-14.82,1.93Z"/>
        <path class="color-text" d="M131.87,43.71c-3.38-8.04-8.1-15.03-14.17-20.98-6.07-5.95-13.28-10.68-21.63-14.17-8.35-3.5-17.48-5.25-27.42-5.25s-19.11,1.75-27.51,5.25c-8.41,3.5-15.64,8.28-21.72,14.36s-10.83,13.13-14.26,21.17C1.72,52.12,0,60.74,0,69.94v.37c0,9.2,1.69,17.83,5.06,25.86,3.37,8.04,8.1,15.03,14.17,20.98,6.07,5.95,13.28,10.67,21.63,14.17,8.34,3.5,17.49,5.24,27.42,5.24s19.11-1.75,27.52-5.24c8.4-3.5,15.64-8.28,21.72-14.36,6.07-6.07,10.83-13.13,14.26-21.16,3.43-8.04,5.15-16.66,5.15-25.86v-.37c0-9.2-1.69-17.82-5.06-25.86ZM109.3,70.31c0,5.75-1.01,11.22-2.99,16.28-1.98,5.05-4.77,9.56-8.3,13.41-3.56,3.88-7.9,6.95-12.92,9.13-5.01,2.19-10.54,3.29-16.44,3.29s-11.6-1.14-16.56-3.4c-4.93-2.24-9.29-5.33-12.95-9.18-3.66-3.86-6.53-8.42-8.51-13.54-1.98-5.11-2.99-10.61-2.99-16.37v-.37c0-5.75,1.01-11.23,2.99-16.28,1.98-5.05,4.78-9.57,8.3-13.41,3.54-3.86,7.85-6.93,12.81-9.13,4.96-2.19,10.52-3.3,16.54-3.3s11.43,1.14,16.46,3.39c5,2.25,9.4,5.34,13.06,9.19,3.66,3.85,6.52,8.41,8.51,13.54,1.98,5.12,2.99,10.63,2.99,16.37v.37Z"/>
        <path class="color-text" d="M105.22,69.94c0-3-.32-5.93-.92-8.77h-17.73c-3.24,0-6.17,1.96-7.4,4.96l-.07.17-8.83-24.28c-1.09-3-3.87-5.07-7.06-5.25-3.21-.21-6.18,1.55-7.61,4.41l-10.01,20h-13c-.56,2.72-.86,5.54-.86,8.44v.33c0,2.47.21,4.88.62,7.23h18.18c3.03,0,5.8-1.71,7.15-4.42l3.9-7.8,9.54,26.23c1.13,3.1,4.05,5.2,7.35,5.26.05,0,.11,0,.17,0,3.24,0,6.16-1.96,7.4-4.96l5.88-14.32h12.73c.37-2.24.57-4.54.57-6.9v-.33Z"/>
      </g>
    </g>
  </svg>

  <hgroup>
    <h1>Obs.js: context-aware web performance for everyone</h1>
    <p><em>Meet your users where they are</em></p>
  </hgroup>

  <details>
    <summary>Contents</summary>
    <ol>
      <li><a href=#section:css-api>CSS API</a></li>
      <li><a href=#section:js-api>JS API</a></li>
      <li><a href=#section:video-demo><code>&lt;video&gt;</code> Demo</a></li>
      <li><a href=#section:analytics>Analytics</a></li>
      <li><a href=#section:showcase>Showcase</a></li>
    </ol>
  </details>

  <p><a href=https://github.com/csswizardry/Obs.js>Obs.js</a> reads a handful of
  browser signals
  (<a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator">Navigator</a>
  and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Battery_Status_API">Battery</a>
  APIs) to infer connection strength, battery status, and device capability. It
  exposes those signals as CSS classes on the <code>&lt;html&gt;</code> element,
  and as properties on <code>window.obs</code>, so you can adapt delivery
  accordingly: serve lower-resolution media, forgo web fonts, disable
  auto-playing video… you name it.</p>

  <p><small>In fact, if you have critically low battery, data saver mode
  enabled, or a weak connection, you won’t see the nice rounded
  <a href="https://fonts.google.com/specimen/Fredoka"><cite>Fredoka</cite></a>
  in the <code>&lt;h1&gt;</code> above—you’ll just see your
  <code>system-ui</code> font:</small></p>

  <script class=c-snippet>
    (() => {

      // Only load Google Fonts if we can show rich media. In browsers that
      // don’t support the relevant APIs, we just go ahead and load it.
      //
      // Attach it to the end of the `body` rather than the `head` so it doesn’t
      // inadvertently block rendering.

      if (window.obs?.shouldAvoidRichMedia === true) {
        return;
      } else {
        const gf = document.createElement('link');
        gf.rel = 'stylesheet';
        gf.href = 'https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap';
        document.body.appendChild(gf);
      }

      // Fun fact: because this `script` is a classic, inline, synchronous
      // `<script>`, ‘the end of the `body`’ in the context of this snippet is
      // actually immediately after this text you’re reading right now. Open
      // DevTools and you’ll see the Google Fonts stylesheet isn’t actually at
      // the `</body>`, but immediately after this code block.
      //
      // Another fun fact: this text you’re reading right now is the *exact*
      // code that the browser just executed. It just has `display: block;`
      // applied to it. Neat!
    })();
  </script>

  <p><a href=https://github.com/csswizardry/Obs.js>Obs.js</a> is built and
  maintained by <a href=https://csswizardry.com>Harry Roberts</a> under the MIT
  license.</p>

  <p>This page shows the <code>.has-*</code> classes that <a
    href=https://github.com/csswizardry/Obs.js>Obs.js</a> adds to the
  <code>&lt;html&gt;</code> element, and the current <code>window.obs</code>
  object where it stores  device and network information.</p>

  <p>Try toggling Data Saver, plugging/unplugging power, or changing networks to
  see updates (where supported).</p>

  <h2 id=section:css-api><code>html.classList</code></h2>

  <p id=classes aria-live=polite></p>

  <h2 id=section:js-api><code>window.obs</code></h2>

  <pre id=obs aria-live=polite></pre>

  <p><small><strong>Note:</strong> API support varies by browser; Chromium has
  the broadest coverage.</small></p>

  <h2 id=section:video-demo><code>&lt;video&gt;</code> Demo</h2>

  <p>If your connection allows it, you should see a small video below. If not,
  you will see a static <code>&lt;img&gt;</code>—what can you see?</p>

  <!--
    - This `preload` is largely pointless as the image will be below the fold.
    - I’m adding for thoroughness as script-injected images are hidden from the
    - preload scanner—this reintroduces them.
    -->
  <link rel=preload as=image href=./assets/poster.png>

  <div class=c-video id=jsVideo></div>

  <script class=c-snippet>
    (() => {

      // Inject a video if we’re on a good enough connection, otherwise just
      // inject a screenshot image.

      const videoWrapper = document.getElementById('jsVideo');

      if (window.obs?.shouldAvoidRichMedia === true) {

        const img = new Image();
        img.src = './assets/poster.png';
        img.alt = '';
        img.width = '1500';
        img.height = '966';
        img.classList.add('c-hero');
        videoWrapper.appendChild(img);

      } else {

        const video = document.createElement('video');
        video.src = './assets/video.min.mp4';
        video.poster = './assets/poster.png';
        video.autoplay = true;
        video.loop = true;
        video.muted = true;
        video.controls = true;
        video.preload = 'auto';

        if (window.obs?.deliveryMode === 'cautious') {
          video.preload = 'metadata';
        }

        if (window.obs?.batteryLow === true) {
          video.autoplay = false;
        }

        videoWrapper.appendChild(video);

      }

    })();
  </script>

  <script>
    // Render helpers
    const byId = id => document.getElementById(id);
    const classesEl = byId('classes');
    const obsEl = byId('obs');

    const interesting = (cls) => cls.startsWith('has-');

    // Map classes to traffic-light colours for quick visual scanning.
    const classify = (name) => {
      // Red (bad)
      if (
        /battery-critical/.test(name) ||
        /latency-high/.test(name) ||
        /bandwidth-low/.test(name) ||
        /ram-very-low/.test(name) ||
        /ram-low/.test(name) ||
        /cpu-low/.test(name) ||
        /connection-capability-weak/.test(name) ||
        /device-capability-weak/.test(name) ||
        /delivery-mode-lite/.test(name)
      ) return 'c-pill u-bad';

      // Yellow (warn)
      if (
        /battery-low/.test(name) ||
        /data-saver/.test(name) ||
        /device-capability-moderate/.test(name) ||
        /ram-medium/.test(name) ||
        /cpu-medium/.test(name) ||
        /bandwidth-medium/.test(name) ||
        /latency-medium/.test(name) ||
        /conservation-preference-conserve/.test(name) ||
        /connection-capability-moderate/.test(name) ||
        /delivery-mode-cautious/.test(name)
      ) return 'c-pill u-warn';

      // Green (good)
      if (
        /connection-capability-strong/.test(name) ||
        /device-capability-strong/.test(name) ||
        /delivery-mode-rich/.test(name) ||
        /bandwidth-high/.test(name) ||
        /ram-high/.test(name) ||
        /cpu-high/.test(name) ||
        /latency-low/.test(name)
      ) return 'c-pill u-good';

      // Neutral
      return 'c-pill';
    };

    function renderClasses() {
      const list = (document.documentElement.className || '')
        .split(/\s+/)
        .filter(Boolean)
        .filter(interesting)
        .sort((a,b)=>a.localeCompare(b));

      if (!list.length) {
        classesEl.innerHTML = '<div>No <code>has-*</code> classes present (APIs may be unavailable).</div>';
        return;
      }

      classesEl.innerHTML = '';
      list.forEach(cls => {
        const span = document.createElement('samp');
        span.className = classify(cls);
        span.textContent = '.' + cls;
        classesEl.appendChild(span);
      });
    }

    function renderObs() {
      try {
        const snapshot = window.obs ? JSON.parse(JSON.stringify(window.obs)) : {};
        obsEl.textContent = JSON.stringify(snapshot, null, 2);
      } catch {
        obsEl.textContent = String(window.obs);
      }
    }

    function renderAll() {
      renderClasses();
      renderObs();
    }

    // Initial paint
    renderAll();

    // Repaint on likely changes (best-effort)
    // If observeChanges=true, Obs.js already listens to connection/battery.
    // Here we just repaint when the microtask queue is free.
    const queueRender = () => Promise.resolve().then(renderAll);

    // Patch minimal hooks so demo repaints when Obs.js updates:
    // (No-op if props don’t change—cheap.)
    ['change', 'levelchange', 'chargingchange'].forEach(evt => {
      // Connection changes (if available)
      if (navigator.connection?.addEventListener && evt === 'change') {
        navigator.connection.addEventListener('change', queueRender, { passive: true });
      }
    });

    // Battery changes (if available)
    if ('getBattery' in navigator) {
      navigator.getBattery().then(b => {
        if (typeof b.addEventListener === 'function') {
          b.addEventListener('levelchange', queueRender);
          b.addEventListener('chargingchange', queueRender);
        }
      }).catch(()=>{ /* no-op */ });
    }

    // Also repaint after a tick to catch initial async battery read
    setTimeout(renderAll, 0);
  </script>





  <h2 id=section:analytics>Analytics</h2>

  <p>If your <dfn id=dfn:rum><abbr title="Real User Monitoring">RUM</abbr></dfn>
  or analytics provider accepts <code>window.obs</code>-style data, you can send
  it off to them! You don’t <em>need</em> to use Obs.js to adapt or change your
  site—you can use it as a purely <b>obs</b>ervational tool to learn more about
  your audience:</p>

  <img src=./assets/speedcurve.png class=c-hero width=1500 height=887 alt="SpeedCurve
  dashboard comparing low vs high latency cohorts. Low latency shows faster
  Largest Contentful Paint (1.08s vs 2.9s), with other metrics largely
  unchanged.">

  <p>I send all of my data off to my friends at <a
    href="https://www.speedcurve.com/">SpeedCurve</a>. With that, I can begin
  segmenting my <a href=#dfn:rum>RUM</a> data and designing strategies to serve
  different demographics.</p>

  <p>Here’s the exact snippet I use to send Obs.js data to <a
    href="https://www.speedcurve.com/">SpeedCurve</a>:</p>

  <script type=module class=c-snippet>
    /**
     * All the data previously captured by Obs.js is now sent to SpeedCurve!
     *
     * I ❤️ SpeedCurve!
     */

    (() => {
      // Bail out if SpeedCurve is not available.
      if (!window.LUX || typeof window.LUX.addData !== 'function') return;

      const obs = window.obs || Object.create(null);

      // Keys we intend to send. Keep in sync with Obs.js
      const keys = [
        'canShowRichMedia',
        'connectionCapability',
        'conservationPreference',
        'cpuBucket',
        'cpuCategory',
        'dataSaver',
        'deliveryMode',
        'deviceCapability',
        'downlinkBucket',
        'downlinkCategory',
        'ramBucket',
        'ramCategory',
        'rttBucket',
        'rttCategory',
        'shouldAvoidRichMedia'
      ];

      for (const key of keys) {
        if (Object.prototype.hasOwnProperty.call(obs, key)) {
          window.LUX.addData(key, obs[key]);
        }
      }
    })();
  </script>





  <h2 id=section:showcase>Showcase</h2>

  <p>These fine folk are using <a
    href=https://github.com/csswizardry/Obs.js>Obs.js</a>:</p>

  <style>

    .c-showcase {
      margin-left: 0;
      list-style: none;

      dt {
        font-weight: bold;

        &::after {
          content: ":";
        }

      }

      dd {
        margin-left: 1.5rem;
      }

    }

  </style>

  <ul class=c-showcase id=jsShowcase>

    <li>
      <img src=./assets/showcase/csswizardry.com.png class=c-hero alt="csswizardry.com homepage screenshot" width=1000 height=594 loading=lazy>
      <dl>
        <dt>Site</dt>
        <dd><a href=https://csswizardry.com>csswizardry.com</a></dd>
        <dt>Usage</dt>
        <dd>Deliver low-resolution hero images on constrained networks; disable
        transitions and animations on low battery mode.</dd>
      </dl>
    </li>

  </ul>

  <script>
    (() => {
      // Shuffle the Showcase so there’s no preferential treatment.
      const showcase = document.querySelector('#jsShowcase');
      const items = [...showcase.querySelectorAll('li')];

      // Bail out if there is nothing to shuffle.
      if (items.length === 1) {
        return;
      } else{

        for (let i = items.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [items[i], items[j]] = [items[j], items[i]];
        }

      }

      showcase.append(...items);
    })();
  </script>

  <p><a href=https://github.com/csswizardry/Obs.js/fork>Submit your site</a></p>





  <script type=application/ld+json>
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebSite",
          "@id": "https://csswizardry.com/#website",
          "url": "https://csswizardry.com/",
          "name": "CSS Wizardry",
          "publisher": {
            "@type": "Person",
            "@id": "https://csswizardry.com/#harry"
          }
        },
        {
          "@type": "WebPage",
          "@id": "https://csswizardry.com/Obs.js/demo/#webpage",
          "url": "https://csswizardry.com/Obs.js/demo/",
          "name": "Obs.js – context-aware web performance for everyone",
          "inLanguage": "en-GB",
          "isPartOf": {
            "@id": "https://csswizardry.com/#website"
          },
          "primaryImageOfPage": {
            "@type": "ImageObject",
            "@id": "https://csswizardry.com/Obs.js/demo/assets/og-image.png#primaryimage",
            "url": "https://csswizardry.com/Obs.js/demo/assets/og-image.png",
            "width": 1800,
            "height": 942,
            "encodingFormat": "image/png"
          },
          "description": "Obs.js reads device and network signals and allows you to build adaptive user experiences.",
          "breadcrumb": {
            "@type": "BreadcrumbList",
            "itemListElement": [
              {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://csswizardry.com/"
              },
              {
                "@type": "ListItem",
                "position": 2,
                "name": "Obs.js",
                "item": "https://github.com/csswizardry/Obs.js"
              },
              {
                "@type": "ListItem",
                "position": 3,
                "name": "Demo",
                "item": "https://csswizardry.com/Obs.js/demo/"
              }
            ]
          }
        },
        {
          "@type": "SoftwareSourceCode",
          "@id": "https://github.com/csswizardry/Obs.js#code",
          "name": "Obs.js",
          "codeRepository": "https://github.com/csswizardry/Obs.js",
          "programmingLanguage": "JavaScript",
          "license": "https://opensource.org/license/mit/",
          "author": {
            "@id": "https://csswizardry.com/#harry"
          },
          "creator": {
            "@id": "https://csswizardry.com/#harry"
          },
          "publisher": {
            "@id": "https://csswizardry.com/#harry"
          },
          "image": "https://csswizardry.com/Obs.js/demo/assets/og-image.png",
          "url": "https://csswizardry.com/Obs.js/demo/"
        },
        {
          "@type": "Person",
          "@id": "https://csswizardry.com/#harry",
          "name": "Harry Roberts",
          "url": "https://csswizardry.com/",
          "sameAs": [
            "https://twitter.com/csswizardry",
            "https://github.com/csswizardry"
          ]
        }
      ]
    }
  </script>
